

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Frequently Asked Questions &mdash; flare 1.3.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Applications/Gallery" href="related.html" />
    <link rel="prev" title="Kernels" href="flare_pp/kernels.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> flare
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="flare/flare.html">Python Code Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="flare_pp/flare_pp.html">C++ Code Documentation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Frequently Asked Questions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#installation-and-packages">Installation and Packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="#gaussian-processes">Gaussian Processes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#otf-on-the-fly-active-learning">OTF (On-the-fly) Active-Learning</a></li>
<li class="toctree-l2"><a class="reference internal" href="#offline-learning">Offline-Learning</a></li>
<li class="toctree-l2"><a class="reference internal" href="#production-md-simulations-using-a-flare-ml-ff">Production MD Simulations using a FLARE ML-FF</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="related.html">Applications/Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="contribute/contribute.html">How To Contribute</a></li>
<li class="toctree-l1"><a class="reference internal" href="citing.html">How to Cite</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">flare</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Frequently Asked Questions</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/faqs.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="frequently-asked-questions">
<h1>Frequently Asked Questions<a class="headerlink" href="#frequently-asked-questions" title="Permalink to this headline">¶</a></h1>
<p>This page is designed to help users troubleshoot commonly encountered questions when performing tasks in the FLARE framework.</p>
<div class="section" id="installation-and-packages">
<h2>Installation and Packages<a class="headerlink" href="#installation-and-packages" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li><dl class="first docutils">
<dt>What do I do if I encounter an mkl error following installation?</dt>
<dd><ul class="first last">
<li>Make sure you load the mkl module, or do <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">install</span> <span class="pre">-y</span> <span class="pre">mkl_fft</span></code>. Then please check <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">list</span></code> and <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">list</span></code> to see if you have two versions of numpy installed by <code class="docutils literal notranslate"><span class="pre">pip</span></code> and <code class="docutils literal notranslate"><span class="pre">conda</span></code>. If so, try uninstalling the <code class="docutils literal notranslate"><span class="pre">pip</span></code> numpy.</li>
<li>Otherwise, reverting to version 1.18 might also fix this error.</li>
</ul>
</dd>
</dl>
</li>
</ol>
</div>
<div class="section" id="gaussian-processes">
<h2>Gaussian Processes<a class="headerlink" href="#gaussian-processes" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><dl class="first docutils">
<dt>How do Gaussian Processes work?</dt>
<dd><p class="first last">Gaussian Processes enjoy a long history of study and there are many excellent resources out there we can recommend.
One such resource (that some of the authors consult quite frequently!) is the textbook
<a class="reference external" href="http://www.gaussianprocess.org/gpml/chapters/RW.pdf">Gaussian Processes for Machine Learning, by Rasmussen and Williams</a>
, with Chapter 2 in particular being a great help.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>How should I choose my cutoff(s)?</dt>
<dd><ul class="first simple">
<li>The right cutoff depends on the system you’re studying: ionic systems often do better with a larger cutoff,</li>
</ul>
<p>while dense systems like diamond can employ smaller cutoffs.</p>
<ul class="simple">
<li>We recommend that you refer to the radial distribution function of your atomic system first, then try a range of cutoff</li>
</ul>
<p>values and examine the model error, optimized hyperparameters, and model likelihood as a function of the cutoff(s).</p>
<ul class="simple">
<li>Keep in mind that the model cutoff is intimately coupled with the radial and angular bases of the model. So, we recommend that</li>
</ul>
<p>model cutoff(s) be tested with varying n_max and l_max for the ACE descriptors. Generally larger cutoff requires larger n_max.</p>
<ul class="simple">
<li>For multi-component systems, a cutoff_matrix can be set with explicit cutoffs for each inter-species interaction (e.g.,</li>
</ul>
<p class="last"><code class="docutils literal notranslate"><span class="pre">cutoff_matrix:</span> <span class="pre">[[cutoff_11,</span> <span class="pre">cutoff_12],[cutoff_21,</span> <span class="pre">cutoff_22]]</span></code> for species 1 and 2), otherwise the matrix will populate with the values of the maximum cutoff listed in the input file.</p>
</dd>
</dl>
</li>
</ol>
</div>
<div class="section" id="otf-on-the-fly-active-learning">
<h2>OTF (On-the-fly) Active-Learning<a class="headerlink" href="#otf-on-the-fly-active-learning" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><dl class="first docutils">
<dt>What is a good strategy for hyperparameter optimization?</dt>
<dd><p class="first">Hyperparameter optimization is important for obtaining a good model and is an important step in the case of a bad choice of priors.
However, the optimization will get slower when more training data are collected, so some tricks may be needed to provide a good model while minimizing training time.
There are a few parameters to notice:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">maxiter</span></code> : maximal number of iterations, usually set to ~20 to prevent training for too long. However, if hyperparameter training is unstable,</li>
</ul>
<p>raising this number can help if the model is not converged within a smaller number of iterations.</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">train_hyps</span></code> : range of DFT calls whererin the hyperparameters will be optimized. We recommend setting the initial value to 10 (i.e., 10th DFT call),</li>
</ul>
<p>since we have observed more stable training, as opposed to training from the initial DFT call.</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">std_tolerance_factor</span></code> : DFT will be called when the predicted uncertainty is above this threshold,</li>
</ul>
<p>which is defined relative to the mean uncertainty in the system. The default value is 1. In general, we recommend that this value be set relative to the number
of species in the system (e.g., -0.01 for 1 species, -0.05 for 2, -0.1 for 3, etc.). If more DFT calls are desired, you can set it to a lower value.</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">update_threshold</span></code> : atoms will only be added to the sparse set of the Gaussian Process when their uncertainty surpasses this threshold. We have found that this</li>
</ul>
<p class="last">value provides a decent number of sparse environment <cite>additions</cite> when set to be 0.1*std_tolerance_factor. This ensures that several atoms are added to the sparse-set of the
Gaussian Process for every DFT call. If this value is set to be closer to the std_tolerance_factor, it may be the case where only 1 atomic environment is added for each DFT call,
which is inefficient depending on the DFT complexity.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>How (why) should a small perturbation be included for the initial structure?</dt>
<dd><p class="first last">If you are starting from a perfect lattice, we recommend adding small random perturbations to the atomic positions,
such that the symmetry of the crystal lattice is broken. This is accomplished using the <cite>jitter</cite> flag in the <cite>yaml</cite> script, in the units of angstrom.
The reason is that the perfect lattice is highly symmetric, thus usually the force on each atom is zero, and the local
environments all look the same. Adding these highly similar environments with close-to-zero forces might raise numerical
stability issues for GP.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Why is the temperature of the simulation unreasonably high?</dt>
<dd><ul class="first simple">
<li>This is the signal of a high-energy configuration being used to start active-learning. Try relaxing the structure before initializing the active-learning trajectory so that your</li>
</ul>
<p class="last">initial structure has atoms in local energy minima. High energy initial structures can yield high forces, leading to instability in the temperature and velocities of the atoms.
* If you are simulating with a high temperature or light atoms, you can try reducing the MD timestep to enhance stability.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>How do I know that my active-learning trajectory is “good”?</dt>
<dd><p class="first last">It is important to do some analysis of your active-learning trajectories both while they are running and once they are completed. We recommend that you keep an eye on the system parameters,
e.g. temperature, pressure, or the radial distribution function. In addition to these system specific markers, we also recommend keeping an eye on the hyperparameters, and making sure that they
make sense numerically.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>When should I stop my active-learning trajectory?</dt>
<dd><p class="first last">Active-learning can be ceased when the number of DFT calls becomes sparse as a function of timestep. The MAE values for energy, forces, and stresses can also indicate when a model has approached a given
threshold in accuracy. If the number of DFT calls remains low throughout the entire trajectory, try altering the conditions under which the system performs MD (e.g., temperature or pressure) or decrease
the <code class="docutils literal notranslate"><span class="pre">std_tolerance_factor</span></code> so that more DFT calls will be made.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>What happens if I get <code class="docutils literal notranslate"><span class="pre">AssertionError</span></code> from <code class="docutils literal notranslate"><span class="pre">assert</span> <span class="pre">np.allclose(lmp_energy,</span> <span class="pre">gp_energy)</span></code>?</dt>
<dd><p class="first last">This error can appear when using <code class="docutils literal notranslate"><span class="pre">PyLAMMPS</span></code> for training on-the-fly with LAMMPS MD. FLARE does a sanity check to make sure LAMMPS energy and GP energy are the same.
This error means their disagreement is not small enough, which might result from unphysical structure, temperature explosion, or unreasonable hyperparameters.
You can try relaxing the initial structure, reducing the timestep, or increasing the lower bound of <code class="docutils literal notranslate"><span class="pre">train_hyps</span></code>.</p>
</dd>
</dl>
</li>
</ol>
</div>
<div class="section" id="offline-learning">
<h2>Offline-Learning<a class="headerlink" href="#offline-learning" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li><dl class="first docutils">
<dt>Why is my offline training selecting so few sparse environments?</dt>
<dd>We have found that it is helpful to reduce the <cite>std_tolerance_factor</cite> below that of what is typically used for active-learning when training a final model with offline learning.
This is fine, since all of the sparse environments being selected are from DFT calculated frames. It is also helpful to track the likelihood and hyperparameters when reducing this value
in order to select an appropriate model.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>How do I know that my offline-trained model is “good”?</dt>
<dd>Several markers can be used to evaluate the success of your offline training. Most immediate is the evaluation of errors as assessed throughout training on the DFT frames being used. Also immediately available
are the hyperparameters, which are based in physical units and should make sense numerically (energy, force, and stress noises relative to the the actual energy, force, and stress lables). The user can also
generate more in-depth analyses, e.g., parity plots of energies, forces, and stresses.</dd>
</dl>
</li>
</ol>
</div>
<div class="section" id="production-md-simulations-using-a-flare-ml-ff">
<h2>Production MD Simulations using a FLARE ML-FF<a class="headerlink" href="#production-md-simulations-using-a-flare-ml-ff" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><dl class="first docutils">
<dt>Which MD engines is FLARE compatible?</dt>
<dd><p class="first last">We commonly employ our trained FLARE models in LAMMPs and the ASE md engines.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>How do I know that my model is performing well?</dt>
<dd><p class="first last">Without diving into system-specific benchmarks that can be done, we recommend using the uncertainty quantification capabilities of FLARE to determine whether your MD simulation is operating within the domains of the
training set. Example scripts for the quantification of uncertianty can be found elsewhere in this repository.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Why is my simulation misbehaving?</dt>
<dd><p class="first">Several parameters can influence the success of the MD simulations that are run after building your FLARE model. It is important to first check that the species match the order that is present in the
lammps coefficient file, and that their masses are assigned appropriately.
- If non-physical environments appear in your simulation (either by visual inspection or via uncertainty analysis), several tricks can be implemented to fix this.</p>
<blockquote>
<div><ol class="arabic simple">
<li>try reducing the timestep. An aggressive timestep can lead to errors in integration and prompt unphysical environments to appear.</li>
<li>toggle the thermostat damping factor (specific to the MD engine being used).</li>
<li>make sure that the initial structure is reasonable and not unreasonably high in energy or does not have high forces. (related to next point)</li>
</ol>
</div></blockquote>
<ul class="last simple">
<li><dl class="first docutils">
<dt>If the temperature of the simulation is unreasonably high upon initialization:</dt>
<dd>(1) try relaxing the structure using built-in methods (e.g., conjugate gradient descent in LAMMPS) so that your initial structure has atoms in local energy minima. High energy initial structures
can yield high forces, leading to temperature increasing drastically.</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
</ol>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="related.html" class="btn btn-neutral float-right" title="Applications/Gallery" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="flare_pp/kernels.html" class="btn btn-neutral float-left" title="Kernels" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2021, Jonathan Vandermause, Yu Xie, Anders Johansson, Cameron Owen

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>